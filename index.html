<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED TECAMAC - Gesti√≥n de Red</title>

    <script>
        var claveCorrecta = "Tecamac2026*";
        if (sessionStorage.getItem("acceso_permitido") !== "true") {
            var intento = prompt("üîê ACCESO RESTRINGIDO\nIngrese clave:");
            if (intento === claveCorrecta) { sessionStorage.setItem("acceso_permitido", "true"); }
            else { window.location.href = "https://google.com"; }
        }
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <style>
        body { background: #0f172a; color: #f8fafc; font-family: 'Segoe UI', sans-serif; }
        .app-header { background: linear-gradient(90deg, #0ea5e9, #2563eb); padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .main-container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        
        /* Botones de Navegaci√≥n */
        .nav-tabs-custom { display: flex; gap: 10px; justify-content: center; margin-bottom: 25px; }
        .tab-btn { background: #1e293b; border: 1px solid #334155; color: #94a3b8; padding: 12px 25px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .tab-btn.active { background: #0ea5e9; color: white; border-color: #0ea5e9; box-shadow: 0 0 15px rgba(14, 165, 233, 0.4); }
        
        /* Buscador */
        #mainSearch { background: white; border-radius: 50px; padding: 15px 30px; font-size: 1.1rem; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2); color: #1e293b; width: 100%; max-width: 600px; margin: 0 auto 30px auto; display: block; }

        /* Estilos de la Tabla */
        #contenedorTabla { background: white; border-radius: 12px; padding: 20px; color: #334155; }
        .table thead th { background: #f1f5f9 !important; color: #475569 !important; font-weight: 600; text-transform: uppercase; font-size: 0.75rem; border-bottom: 2px solid #e2e8f0; }
        
        /* COLORES DE FILAS SOLICITADOS */
        .fila-cancelada { background-color: #fee2e2 !important; color: #991b1b !important; } /* Rojo claro */
        .fila-inactiva { background-color: #f1f5f9 !important; color: #64748b !important; }   /* Gris claro */
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

    <div class="app-header">
        <h1>üõ∞Ô∏è SISTEMA CORE TECAMAC</h1>
        <p>An√°lisis de Red y Estatus de Cuentas</p>
    </div>

    <div class="main-container">
        <div class="nav-tabs-custom">
            <button class="tab-btn active" data-tab="busqueda">üîç B√∫squeda Individual</button>
            <button class="tab-btn" data-tab="analisis">üìä An√°lisis Masivo</button>
        </div>

        <div id="tab-busqueda" class="tab-content active">
            <input type="text" id="mainSearch" placeholder="Buscar por Cuenta, QR u OLT...">
            
            <div id="contenedorTabla">
                <table id="tablaMaestra" class="table w-100">
                    <thead>
                        <tr>
                            <th>Cuenta</th>
                            <th>QR</th>
                            <th>OLT</th>
                            <th>FSP</th>
                            <th>Lat</th>
                            <th>Lon</th>
                            <th>Ubicaci√≥n</th>
                            <th>Puerto N2</th>
                            <th>Estatus</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>

        </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        // SEGURO: Evita el cuadro de error molesto si faltan datos en el CSV
        $.fn.dataTable.ext.errMode = 'none';

        var table;
        var datosCSV = [];

        $(document).ready(function () {
            // Cambio de pesta√±as
            $('.tab-btn').on('click', function () {
                $('.tab-btn').removeClass('active');
                $(this).addClass('active');
                $('.tab-content').removeClass('active');
                $('#tab-' + $(this).data('tab')).addClass('active');
            });

            // Cargar CSV
            Papa.parse("datos.csv", {
                download: true,
                header: false,
                skipEmptyLines: true,
                complete: function (results) {
                    datosCSV = results.data.slice(1);

                    table = $('#tablaMaestra').DataTable({
                        data: datosCSV,
                        dom: 'rtip',
                        pageLength: 20,
                        language: { url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json" },
                        // Define columna 8 (Estatus) con valor vac√≠o por defecto si no existe
                        columnDefs: [{ targets: 8, defaultContent: "" }],
                        
                        // L√ìGICA DE COLORES POR FILA
                        createdRow: function(row, data, dataIndex) {
                            var estatus = (data[8] || "").toUpperCase().trim();
                            
                            if (estatus === "CANCELADA") {
                                $(row).addClass('fila-cancelada');
                            } else if (estatus === "INACTIVA") {
                                $(row).addClass('fila-inactiva');
                            }
                        }
                    });

                    // Buscador vinculado
                    $('#mainSearch').on('keyup', function () {
                        table.search(this.value).draw();
                    });
                }
            });
        });
    </script>
</body>
</html>
