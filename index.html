<!DOCTYPE html>
<html lang="es">

<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>RED TECAMAC - AnÃ¡lisis de Afectaciones</title>

Â  Â  <script>
Â  Â  Â  Â  var claveCorrecta = "Tecamac2026*";
Â  Â  Â  Â  if (sessionStorage.getItem("acceso_permitido") !== "true") {
Â  Â  Â  Â  Â  Â  var intento = prompt("ğŸ” ACCESO\nIngrese clave:");
Â  Â  Â  Â  Â  Â  if (intento === claveCorrecta) { sessionStorage.setItem("acceso_permitido", "true"); }
Â  Â  Â  Â  Â  Â  else { window.location.href = "https://google.com"; }
Â  Â  Â  Â  }
Â  Â  </script>

Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
Â  Â  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

Â  Â  <style>
Â  Â  Â  Â  * { box-sizing: border-box; }
Â  Â  Â  Â  body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; color: #e8e8e8; font-family: 'Segoe UI', sans-serif; padding: 0; margin: 0; }
Â  Â  Â  Â  .app-header { background: linear-gradient(135deg, #00d4ff 0%, #0077b6 50%, #004a99 100%); color: white; padding: 30px 20px; text-align: center; box-shadow: 0 4px 30px rgba(0, 212, 255, 0.3); position: relative; overflow: hidden; }
Â  Â  Â  Â  .app-header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
Â  Â  Â  Â  .app-header h1 { font-size: 2rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); position: relative; z-index: 1; }
Â  Â  Â  Â  .app-header p { opacity: 0.9; font-size: 1rem; margin-top: 8px; position: relative; z-index: 1; }
Â  Â  Â  Â  .main-container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
Â  Â  Â  Â  .nav-tabs-custom { display: flex; gap: 10px; margin-bottom: 25px; justify-content: center; }
Â  Â  Â  Â  .tab-btn { background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(0, 212, 255, 0.3); color: #ccc; padding: 15px 35px; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; backdrop-filter: blur(10px); }
Â  Â  Â  Â  .tab-btn:hover { background: rgba(0, 212, 255, 0.2); border-color: #00d4ff; color: white; transform: translateY(-2px); }
Â  Â  Â  Â  .tab-btn.active { background: linear-gradient(135deg, #00d4ff, #0077b6); border-color: #00d4ff; color: white; box-shadow: 0 5px 25px rgba(0, 212, 255, 0.4); }
Â  Â  Â  Â  .tab-content { display: none; }
Â  Â  Â  Â  .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .search-wrapper { max-width: 700px; margin: 0 auto 30px auto; }
Â  Â  Â  Â  #mainSearch { background: rgba(255, 255, 255, 0.95); border: none; border-radius: 50px !important; padding: 20px 30px !important; width: 100% !important; font-size: 1.1rem; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); outline: none; color: #333; transition: all 0.3s ease; }
Â  Â  Â  Â  #mainSearch:focus { box-shadow: 0 10px 50px rgba(0, 212, 255, 0.5); transform: scale(1.02); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .analysis-panel { background: rgba(255, 255, 255, 0.05); border-radius: 20px; padding: 30px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
Â  Â  Â  Â  .paste-area { background: rgba(0, 0, 0, 0.3); border: 2px dashed rgba(0, 212, 255, 0.5); border-radius: 15px; padding: 20px; min-height: 200px; color: #ccc; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.85rem; resize: vertical; width: 100%; outline: none; transition: all 0.3s ease; }
Â  Â  Â  Â  .btn-analyze { background: linear-gradient(135deg, #00d4ff, #0077b6); border: none; color: white; padding: 15px 50px; border-radius: 50px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; box-shadow: 0 5px 25px rgba(0, 212, 255, 0.4); }
Â  Â  Â  Â  .btn-clear { background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.2); color: #ccc; padding: 15px 30px; border-radius: 50px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; margin-left: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .results-panel { margin-top: 30px; display: none; }
Â  Â  Â  Â  .results-panel.visible { display: block; }
Â  Â  Â  Â  .stats-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
Â  Â  Â  Â  .stat-card { background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); }
Â  Â  Â  Â  .stat-card .number { font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #00d4ff, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #contenedorTabla, #contenedorResultados { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); color: #333; }
Â  Â  Â  Â  .table { color: #333 !important; }
Â  Â  Â  Â  .table thead th { background: linear-gradient(135deg, #004a99, #0077b6) !important; color: white !important; font-size: 0.75rem; padding: 15px 12px !important; }

Â  Â  Â  Â  .fila-cancelada { background-color: #ffcccc !important; color: #990000 !important; font-weight: 500; }
Â  Â  Â  Â  .fila-inactiva { background-color: #e2e8f0 !important; color: #475569 !important; }
Â  Â  Â  Â  .not-found { background: rgba(255, 82, 82, 0.1) !important; color: #ff5252 !important; }

Â  Â  Â  Â  .qr-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem; }
Â  Â  Â  Â  .qr-hot { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: white; }
Â  Â  Â  Â  .qr-warm { background: linear-gradient(135deg, #f7971e, #ffd200); color: #333; }
Â  Â  Â  Â  .qr-normal { background: rgba(0, 119, 182, 0.15); color: #0077b6; }
Â  Â  Â  Â  .footer-info { text-align: center; padding: 20px; color: #666; font-size: 0.85rem; }
Â  Â  </style>
</head>

<body>

Â  Â  <div class="app-header">
Â  Â  Â  Â  <h1>ğŸ›°ï¸ SISTEMA CORE TECAMAC</h1>
Â  Â  Â  Â  <p>AnÃ¡lisis de Red y Afectaciones Masivas</p>
Â  Â  </div>

Â  Â  <div class="main-container">

Â  Â  Â  Â  <div class="nav-tabs-custom">
Â  Â  Â  Â  Â  Â  <button class="tab-btn active" data-tab="busqueda">ğŸ” BÃºsqueda Individual</button>
Â  Â  Â  Â  Â  Â  <button class="tab-btn" data-tab="analisis">ğŸ“Š AnÃ¡lisis Masivo</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="tab-busqueda" class="tab-content active">
Â  Â  Â  Â  Â  Â  <div class="search-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="mainSearch" placeholder="ğŸ” Buscar por Cuenta, QR u OLT..." autocomplete="off">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="mensajeVacio" class="text-center mt-5">
Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 3rem; margin-bottom: 10px;">ğŸ“¡</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Ingresa un tÃ©rmino de bÃºsqueda...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="contenedorTabla" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  <table id="tablaMaestra" class="table table-hover w-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Cuenta</th> <th>QR</th> <th>OLT</th> <th>FSP</th> <th>Lat</th> <th>Lon</th> <th>UbicaciÃ³n</th> <th>Puerto N2</th> <th>Estatus</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="tab-analisis" class="tab-content">
Â  Â  Â  Â  Â  Â  <div class="analysis-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="color: #00d4ff; margin-bottom: 20px;">ğŸ“‹ Pegar datos del OLT</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="pasteArea" class="paste-area" placeholder="Pega aquÃ­ los datos del OLT..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-analyze" onclick="analizarDatos()">ğŸ” Analizar AfectaciÃ³n</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-clear" onclick="limpiarAnalisis()">ğŸ—‘ï¸ Limpiar</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="resultadosAnalisis" class="results-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats-cards">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="number" id="statTotal">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="label">Clientes Analizados</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="number" id="statEncontrados">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="label">Encontrados</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="number" id="statNoEncontrados">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="label">No Encontrados</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="number" id="statQRs">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="label">QRs Afectados</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="contenedorResultados">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table id="tablaResultados" class="table table-hover w-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Cuenta</th> <th>QR</th> <th>OLT</th> <th>FSP</th> <th>Lat</th> <th>Lon</th> <th>Estatus</th> <th>Clientes en QR</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="bodyResultados"></tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <div class="footer-info">
Â  Â  Â  Â  Sistema Core Tecamac | Datos cargados: <span id="totalRegistros">0</span> registros
Â  Â  </div>

Â  Â  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
Â  Â  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
Â  Â  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

Â  Â  <script>
Â  Â  Â  Â  $.fn.dataTable.ext.errMode = 'none';

Â  Â  Â  Â  var table;
Â  Â  Â  Â  var tableResultados;
Â  Â  Â  Â  var datosCSV = [];
Â  Â  Â  Â  var datosIndexados = {};

Â  Â  Â  Â  $(document).ready(function () {
Â  Â  Â  Â  Â  Â  $('.tab-btn').on('click', function () {
Â  Â  Â  Â  Â  Â  Â  Â  var tabId = $(this).data('tab');
Â  Â  Â  Â  Â  Â  Â  Â  $('.tab-btn').removeClass('active');
Â  Â  Â  Â  Â  Â  Â  Â  $(this).addClass('active');
Â  Â  Â  Â  Â  Â  Â  Â  $('.tab-content').removeClass('active');
Â  Â  Â  Â  Â  Â  Â  Â  $('#tab-' + tabId).addClass('active');
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Papa.parse("datos.csv", {
Â  Â  Â  Â  Â  Â  Â  Â  download: true,
Â  Â  Â  Â  Â  Â  Â  Â  header: false,
Â  Â  Â  Â  Â  Â  Â  Â  skipEmptyLines: true,
Â  Â  Â  Â  Â  Â  Â  Â  complete: function (results) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datosCSV = results.data.slice(1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#totalRegistros').text(datosCSV.length.toLocaleString());

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datosCSV.forEach(function (row) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (row[0]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var cuentaLimpia = row[0].replace(/[^0-9]/g, '').trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datosIndexados[cuentaLimpia] = row;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  table = $('#tablaMaestra').DataTable({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: datosCSV,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deferRender: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scrollY: "50vh",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scrollCollapse: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom: 'rtip',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pageLength: 25,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  language: { "info": "Mostrando _TOTAL_ registros", "paginate": { "next": "Sig", "previous": "Ant" } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  columnDefs: [{ targets: 8, defaultContent: "ACTIVA" }],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdRow: function(row, data, dataIndex) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var estatus = (data[8] || "").toUpperCase().trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (estatus === "CANCELADA") $(row).addClass('fila-cancelada');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (estatus === "INACTIVA") $(row).addClass('fila-inactiva');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#mainSearch').on('keyup input', function () {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var val = $(this).val().trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (val.length < 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#contenedorTabla').hide();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#mensajeVacio').show();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  table.search('').draw();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#contenedorTabla').show();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#mensajeVacio').hide();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  table.search(val).draw();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  function extraerCuentas(texto) {
Â  Â  Â  Â  Â  Â  var cuentas = [];
Â  Â  Â  Â  Â  Â  var lineas = texto.split('\n');
Â  Â  Â  Â  Â  Â  lineas.forEach(function (linea) {
Â  Â  Â  Â  Â  Â  Â  Â  linea = linea.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (!linea) return;
Â  Â  Â  Â  Â  Â  Â  Â  var matchDesc = linea.match(/(\d{10})_TP_/i);
Â  Â  Â  Â  Â  Â  Â  Â  if (matchDesc) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cuentas.push(matchDesc[1]);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var matchNumeros = linea.match(/\b(0\d{9})\b/g);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (matchNumeros) { matchNumeros.forEach(n => cuentas.push(n)); }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return [...new Set(cuentas)];
Â  Â  Â  Â  }

Â  Â  Â  Â  function analizarDatos() {
Â  Â  Â  Â  Â  Â  var texto = $('#pasteArea').val();
Â  Â  Â  Â  Â  Â  if (!texto.trim()) return alert('Pega los datos primero.');

Â  Â  Â  Â  Â  Â  if (tableResultados) { tableResultados.destroy(); }

Â  Â  Â  Â  Â  Â  var cuentas = extraerCuentas(texto);
Â  Â  Â  Â  Â  Â  var conteoQR = {};
Â  Â  Â  Â  Â  Â  var encontrados = 0;
Â  Â  Â  Â  Â  Â  var noEncontrados = 0;
Â  Â  Â  Â  Â  Â  var html = '';

Â  Â  Â  Â  Â  Â  cuentas.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  Â  var d = datosIndexados[c];
Â  Â  Â  Â  Â  Â  Â  Â  if(d) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var qr = d[1] || 'N/A';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  conteoQR[qr] = (conteoQR[qr] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  cuentas.forEach(function (cuenta) {
Â  Â  Â  Â  Â  Â  Â  Â  var d = datosIndexados[cuenta];
Â  Â  Â  Â  Â  Â  Â  Â  if (d) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  encontrados++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var est = (d[8] || "ACTIVA").toUpperCase().trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var qrCount = conteoQR[d[1]] || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var badgeClass = qrCount >= 5 ? 'qr-hot' : (qrCount >= 3 ? 'qr-warm' : 'qr-normal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var rowCl = (est === "CANCELADA") ? "fila-cancelada" : (est === "INACTIVA" ? "fila-inactiva" : "");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr class="${rowCl}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><strong>${cuenta}</strong></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="qr-badge ${badgeClass}">${d[1]}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${d[2]}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${d[3]}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${d[4] || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${d[5] || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${est}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${qrCount}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noEncontrados++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr class="not-found"><td>${cuenta}</td><td colspan="7">NO ENCONTRADO EN BASE</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  $('#bodyResultados').html(html);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  tableResultados = $('#tablaResultados').DataTable({
Â  Â  Â  Â  Â  Â  Â  Â  dom: 'rtip',
Â  Â  Â  Â  Â  Â  Â  Â  pageLength: 50,
Â  Â  Â  Â  Â  Â  Â  Â  language: { "info": "Mostrando _TOTAL_ resultados" }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  $('#statTotal').text(cuentas.length);
Â  Â  Â  Â  Â  Â  $('#statEncontrados').text(encontrados);
Â  Â  Â  Â  Â  Â  $('#statNoEncontrados').text(noEncontrados);
Â  Â  Â  Â  Â  Â  $('#statQRs').text(Object.keys(conteoQR).length);
Â  Â  Â  Â  Â  Â  $('#resultadosAnalisis').addClass('visible');
Â  Â  Â  Â  }

Â  Â  Â  Â  function limpiarAnalisis() {
Â  Â  Â  Â  Â  Â  if (tableResultados) { tableResultados.destroy(); tableResultados = null; }
Â  Â  Â  Â  Â  Â  $('#bodyResultados').empty();
Â  Â  Â  Â  Â  Â  $('#pasteArea').val('');
Â  Â  Â  Â  Â  Â  $('#resultadosAnalisis').removeClass('visible');
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
